{% extends "base.html" %}

{% block title %}Add KPI Data - Enterprise KPI Monitoring{% endblock %}

{% block content %}
<div class="form-container">
    <div class="card">
        <div class="card-header">
            <h2>Add KPI Data</h2>
        </div>
        <div class="card-body">
            <form method="POST" action="/add-kpi-data">
                <div class="form-group">
                    <label for="department">Department:</label>
                    <select id="department" name="department_id" class="form-control" required>
                        <option value="">Select Department</option>
                        {% for department in departments %}
                            <option value="{{ department.id }}">{{ department.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="kpi">KPI:</label>
                    <select id="kpi" name="kpi_id" class="form-control" required>
                        <option value="">Select KPI</option>
                        {% for kpi in kpis %}
                            <option value="{{ kpi.id }}" data-department="{{ kpi.department_id }}">{{ kpi.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="value">Value:</label>
                    <input type="number" id="value" name="value" class="form-control" step="0.01" required>
                </div>

                <div class="form-group">
                    <label for="target">Target:</label>
                    <input type="number" id="target" name="target" class="form-control" step="0.01" required>
                </div>

                <div class="form-group">
                    <label for="period">Period:</label>
                    <select id="period" name="period" class="form-control" required>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="yearly">Yearly</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="notes">Notes (Optional):</label>
                    <textarea id="notes" name="notes" class="form-control" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Add KPI Data</button>
                    <a href="/" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.getElementById('department').addEventListener('change', function() {
    const selectedDepartment = this.value;
    const kpiSelect = document.getElementById('kpi');
    const kpiOptions = kpiSelect.getElementsByTagName('option');
    
    kpiSelect.value = '';
    
    for (let i = 1; i < kpiOptions.length; i++) {
        const option = kpiOptions[i];
        const optionDepartment = option.getAttribute('data-department');
        
        if (selectedDepartment === '' || optionDepartment === selectedDepartment) {
            option.style.display = 'block';
        } else {
            option.style.display = 'none';
        }
    }
});
</script>
{% endblock %}